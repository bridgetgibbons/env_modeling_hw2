---
title: "Assignment 3"
author: "Kaili Brande, Bridget Gibbons"
date: "4/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading in necessary packages, the data, and the updated yield model

```{r}


library(ggplot2)
library(pse)
library(sensitivity)
library(tidyverse)


clim = data.frame(read_csv("clim.csv"))

```

```{r}

# Adjust your almond model to  output ONLY the mean almond yield anomoly IF the users sets parameter (e.g mean_only = TRUE))

source("yield_function_assignment3.R")

yield_function_assignment3(climate = clim)

# Because our function has mean_only set to TRUE, the value printed below is our mean value

```

# Performing a sensitivity analysis of how mean anomaly varies ALL of the parameters used in the yield model 
# Using the LHS method:

```{r}

# Assuming parameters are normally distributed with standard deviation of 20% mean value

# First defining the range of input parameters

factors = c("x1", "x2", "x3", "x4", "intercept", "climate", "mean_only")

# Deciding how many parameter sets to run

nsets = 100

# Indicating which distribution

q = c("qnorm", "qnorm", "qnorm", "qnorm", "qnorm", "qnorm", "qnorm")

# Defining arguments

### standard deviation is 0.20 * mean = (0.20 * -0.4255) = -0.0851

q.arg = list(list(mean = -0.4255, sd = -0.0851), )

# Generating the samples

y = LHS(NULL, factors, nsets, q, q.arg)
LHS_pars = get.data(y)

# Creating a data frame to store the results when we run the model

LHS_results = matrix(nrow=nsets, ncol= )

# Now running the model over these parameter sets
### We will use the faster way, using mapply (versus for loop)

LHS_model_results = mapply(FUN = yield_function_assignment3, , , MoreArgs = list(clim=clim))

# this is example below, remove when done
tmp= mapply(FUN=almond, Tmincoeff1=sens_pars$Tmincoeff1, Tmincoeff2=sens_pars$Tmincoeff2, MoreArgs=list(clim=clim))

# Putting the results in our previously created matrix

LHS_results = matrix((unlist(LHS_model_results)), ncol= , byrow=TRUE)

### Assigning column names

colnames(LHS_results)=c("","")

```

## Ranking the parameters in term of their sensitivity

```{r}

# use plotprcc to graph or use the prcc column of the data frame to determine the ranks?

```

## Graphing uncertainty in mean yield anomaly across all parameter uncertainty (boxplot and cumulative distribution of the output)

```{r}

# use tell() and plotscatter or ggplot and geom_boxplot()

```


# Repeating using the Sobol method:

```{r}

# sobel method

# number of parameters
np = 500

# distributions for parameters

sobel_x1 = rnorm(mean = -0.015, sd = 0.003, n = np)
sobel_x2 = rnorm(mean = -0.0046, sd = 0.00092, n = np)
sobel_x3 = rnorm(mean = -0.07, sd = 0.014, n = np)
sobel_x4 = rnorm(mean = 0.0043, sd = 0.00086, n = np)

X1 = cbind.data.frame(sobel_x1, sobel_x2, sobel_x3, sobel_x4)

# repeate distribution sampling

sobel_x1 = rnorm(mean = -0.015, sd = 0.003, n = np)
sobel_x2 = rnorm(mean = -0.0046, sd = 0.00092, n = np)
sobel_x3 = rnorm(mean = -0.07, sd = 0.014, n = np)
sobel_x4 = rnorm(mean = 0.0043, sd = 0.00086, n = np)

X2 = cbind.data.frame(sobel_x1, sobel_x2, sobel_x3, sobel_x4)

sens_yield_sobel = sobol2007(model = NULL, X1, X2, nboot = 100)

# run model for the parameter sets

# getting error: no applicable method for 'group_by_' applied to an object of class "c('double', 'numeric')

sobel_result = mapply(FUN = yield_function_assignment3, x1 = sens_yield_sobel$X$sobel_x1, x2 = sens_yield_sobel$X$sobel_x2, x3 = sens_yield_sobel$X$sobel_x3, x4 = sens_yield_sobel$X$sobel_x4, climate = clim)

sens_yield_sobel = sensitivity::tell(sens_yield_sobel, sobel_result, sobel_result.names="ga")

sens_yield_sobel$S

sens_yield_sobel$T

print(sens_yield_sobel)
plot(sens_yield_sobel)

sens_yield$prcc


```

## Ranking the parameters in term of their sensitivity

```{r}



```

## Graphing uncertainty in mean yield anomaly across all parameter uncertainty (boxplot and cumulative distribution of the output)

```{r}


```


# Repeating both methods using twice as many parameter sets as you did in your first sensitivity analysis, to evaluate how this changes the sensitivity results

```{r}


```

## 