---
title: "climate_crop_model"
author: "Bridget Gibbons"
date: "4/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading in the climate data provided (clim.txt): 

```{r}

# load necessary packages
# read in the climate data

library(tidyverse)
clim = data.frame(read_csv("clim.csv"))


clim_month = clim %>% 
  group_by(month, year) %>% 
  summarize(meantmax = mean(tmax_c), meantmin = mean(tmin_c), precip=mean(precip)) 

## gives average monthly maximum and minimum daily temperatures, and monthly precipitation from a data frame called clim


## Filtering the data frame for only temperatures in month 1 and precipitation in month 2.

clim_mintemp = clim_month %>% 
  select("month", "year", "meantmin") %>% 
  filter(month == 2) %>% 
  rename(month_temp = month)

clim_precip = clim_month %>% 
  select("month", "year", "precip") %>% 
  filter(month == 1) %>% 
  rename(month_precip = month)

## Now combining the two data frames above into one usable data frame, "clim_joined":

clim_joined <- clim_mintemp %>% 
  inner_join(clim_precip, by = c("year"))

clim_joined <- clim_joined %>% 
  ungroup() %>% 
  select(-"month_temp", -"month_precip")


```

# 3. 
# Bringing in our model from our .R file:

```{r}

source("yield_function_bg.R")

yield_function_bg(climate = clim)

```


## Using our model to estimate how almond yield anomalies for each year in the record:

```{r}

## for the input "precipitation" in the model
## precipitation = clim_month_1and2$precip

```


## Graphing the results:

```{r}

library(ggplot2)

# theme = minimal

```


# 4.
## Estimating the mean annual yield anomaly if the last 20 years had been 2C warmer:

```{r}

# create new data frame for warmer climates by adding 2 to each tmin_c value

clim_warmer <- clim %>% 
  mutate(tmin_c = tmin_c + 2)

```

# 5.
## Varying one of the parameters by sampling from a normal distribution; with mean the value from Lobell et al., (2006) and standard deviation 10% of the mean

```{r}

# create parameter values for x4 from a normal distribution
# it needs to have 24 values

new_param_x4 <- as.data.frame(matrix(nrow = 22, ncol = 1)) # create a data frame to store the parameter values
colnames(new_param_x4) = c("x4_new")

new_param_x4$x4_new <- rnorm(n = 22, mean = 0.0043, sd = 0.00043) # fill in the dataframe column with new parameter values for x4: centered on a mean of 0.0043 with a standard deviation of 10% of the meean

```

## Creating a box plot of mean annual yield anomaly for baseline and 2C climate (boxes show variation due to uncertainty in the parameter):

```{r}

# run the model for baseline temperature using new x4 parameter

baseline_newparam <- yield_function_bg(climate = clim, x4 = new_param_x4$x4_new)

# run the model for 2C warmer temperature using new x4 parameter

warmer_newparam <- yield_function_bg(climate = clim_warmer, x4 = new_param_x4$x4_new)

# get the relevant values out of the list and into dataframe to use in the plot

baseline_newparam_df <- as.data.frame(baseline_newparam[1])
warmer_newparam_df <- as.data.frame(warmer_newparam[1])

boxplot_param_df <- inner_join(baseline_newparam_df, warmer_newparam_df, by = "year") %>% 
  mutate(baseline = YA.x, warmer = YA.y)

# create a box plot to compare the two

boxplot_param_df$year <- as.factor(boxplot_param_df$year)

param_boxplots <- ggplot(boxplot_param_df, aes(x = year)) +
  geom_boxplot(aes(y = baseline), color = "blue") +
  geom_boxplot(aes(y = warmer), color = "green")

param_boxplots

```
